{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/web-nu%20trang/tierra/client/src/app/%28user%29/cart/page.js"],"sourcesContent":["\"use client\";\nimport React from \"react\";\nimport { toIntegerVND } from \"../utils/price\";\nimport InsideCart from \"@/assets/icons/inside_cart\";\n\nconst fmt = (v) => new Intl.NumberFormat(\"vi-VN\", { maximumFractionDigits: 0 }).format(v);\n\nconst loadCart = () => {\n  if (typeof window === \"undefined\") return [];\n  try {\n    const raw = localStorage.getItem(\"cart_items\");\n    const parsed = JSON.parse(raw || \"[]\");\n    return Array.isArray(parsed) ? parsed : [];\n  } catch {\n    return [];\n  }\n};\n\nconst saveCart = (items) => {\n  try {\n    localStorage.setItem(\"cart_items\", JSON.stringify(items));\n  } catch {}\n};\n\nexport default function Page() {\n  const [items, setItems] = React.useState([]);\n\n  React.useEffect(() => {\n    setItems(loadCart());\n  }, []);\n\n  const setAndSave = (updater) => {\n    setItems((prev) => {\n      const next = typeof updater === \"function\" ? updater(prev) : updater;\n      saveCart(next);\n      return next;\n    });\n  };\n\n  const toggleAll = (checked) => {\n    setAndSave(items.map((it) => ({ ...it, selected: !!checked })));\n  };\n\n  const toggleOne = (id, checked) => {\n    setAndSave(items.map((it) => (String(it.product_id) === String(id) ? { ...it, selected: !!checked } : it)));\n  };\n\n  const removeOne = (id) => {\n    setAndSave(items.filter((it) => String(it.product_id) !== String(id)));\n  };\n\n  const clearAll = () => setAndSave([]);\n\n  const changeQty = (id, delta) => {\n    setAndSave(\n      items.map((it) => {\n        if (String(it.product_id) !== String(id)) return it;\n        const next = Math.max(1, (Number(it.quantity) || 1) + delta);\n        return { ...it, quantity: next };\n      })\n    );\n  };\n\n  const priceParts = (it) => {\n    const price = toIntegerVND(it.price);\n    const discount = toIntegerVND(it.discount_price);\n    const has = discount > 0 && discount < price;\n    const final = has ? Math.max(price - discount, 0) : price;\n    return { price, discount: has ? discount : 0, final };\n  };\n\n  const selectedItems = items.filter((it) => it.selected);\n  const subtotal = selectedItems.reduce((sum, it) => sum + priceParts(it).price * (Number(it.quantity) || 1), 0);\n  const discountTotal = selectedItems.reduce((sum, it) => sum + priceParts(it).discount * (Number(it.quantity) || 1), 0);\n  const total = Math.max(subtotal - discountTotal, 0);\n\n  const allChecked = items.length > 0 && items.every((it) => it.selected);\n\n  if (items.length === 0) {\n    return (\n      <div className=\"w-full flex justify-center mt-6 mb-12\">\n        <div className=\"w-[90%] max-w-[1200px]\">\n          <div className=\"bg-[#ECECEC] rounded-xl border p-10 flex items-center justify-center h-[420px]\">\n            <div className=\"text-center text-gray-500\">\n              <div className=\"mx-auto mb-4 w-24 h-24 bg-gray-300 rounded-full\" />\n              <div className=\"text-lg\">Giỏ hàng hiện đang trống</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full flex justify-center mt-6 mb-12\">\n      <div className=\"w-[90%] max-w-[1200px]\">\n        <div className=\"bg-[#ECECEC] rounded-xl border p-6\">\n          <div className=\"text-center text-2xl font-semibold mb-6\">Giỏ hàng</div>\n          <div className=\"flex items-center justify-between mb-4\">\n            <label className=\"flex items-center gap-2 text-sm\">\n              <input\n                type=\"checkbox\"\n                checked={allChecked}\n                onChange={(e) => toggleAll(e.target.checked)}\n              />\n              Tất cả sản phẩm\n            </label>\n            <button className=\"text-sm text-red-500\" onClick={clearAll}>Xóa tất cả</button>\n          </div>\n\n          <div className=\"divide-y bg-white rounded-lg border\">\n            {items.map((it) => {\n              const { price, final } = priceParts(it);\n              return (\n                <div key={it.product_id} className=\"p-4 flex items-center gap-4\">\n                  <input\n                    type=\"checkbox\"\n                    checked={!!it.selected}\n                    onChange={(e) => toggleOne(it.product_id, e.target.checked)}\n                  />\n                  {it.image_url ? (\n                    <img src={it.image_url} alt={it.name} className=\"w-[64px] h-[64px] object-cover rounded\" />\n                  ) : (\n                    <div className=\"w-[64px] h-[64px] bg-gray-200 rounded\" />\n                  )}\n                  <div className=\"flex-1\">\n                    <div className=\"text-[16px]\">{it.name}</div>\n                    <div className=\"mt-2 inline-flex items-center border rounded\">\n                      <button className=\"px-3 py-1\" onClick={() => changeQty(it.product_id, -1)}>-</button>\n                      <div className=\"px-4 py-1 border-l border-r select-none\">{Number(it.quantity) || 1}</div>\n                      <button className=\"px-3 py-1\" onClick={() => changeQty(it.product_id, 1)}>+</button>\n                    </div>\n                    <div className=\"mt-2 text-[#3A3A3A] font-semibold\">{fmt(final)} đ</div>\n                  </div>\n                  <button\n                    className=\"text-gray-400 hover:text-red-500\"\n                    title=\"Xóa\"\n                    onClick={() => removeOne(it.product_id)}\n                  >\n                    <InsideCart/>\n                  </button>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className=\"mt-6 grid grid-cols-1 md:grid-cols-3\">\n            <div className=\"md:col-start-3 md:col-span-1 md:justify-self-end w-full md:w-[300px]\">\n              <div className=\"text-sm text-gray-700 flex justify-between\"><span>Tạm tính</span><span>{fmt(subtotal)} đ</span></div>\n              <div className=\"text-sm text-gray-700 flex justify-between\"><span>Giảm giá</span><span>{fmt(discountTotal)} đ</span></div>\n              <div className=\"text-base font-semibold flex justify-between mt-1\"><span>Tổng tiền</span><span>{fmt(total)} đ</span></div>\n              <button className=\"mt-4 w-full h-[44px] rounded-full bg-[#9B8D6F] text-white\">Tiếp tục</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}